<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0">
    <title>himatsubushi</title>
    <link rel="stylesheet" href="maxScreeen.css">
</head>
<body class="body">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <!-- オープニング -->
    <div id="opening">
        <div id="op-content">
            <div id="op-message">
                Welcome Page
            </div>
        </div>
    </div>
    <!-- サイドバー -->
    <aside> 
        <nav>
            <ul>
                <li>a<br>d<br>rrr</li>
                <li><br>d<br></li>
                <li><br>c<br></li>
            </ul>
        </nav>
    </aside>
    <!-- メイン -->
    <main>
        <h1>himatsubushi</h1>
        <div>暇つぶし1</div>
        <div>暇つぶし2</div>
        <div class="hima3">暇つぶし3</div>
        <div>暇つぶし4</div>
        <div>暇つぶし5</div>
        <div>暇つぶし6</div>
        <div>暇つぶし7</div>
        <div>暇つぶし8</div>
        <div>暇つぶし9</div>
        <div>暇つぶし10</div>
        <div>暇つぶし11</div>
        <div id="top">
            <i data-py="0.3">W</i>
            <i data-py="0.6">e</i>
            <i data-py="0.1">l</i>
            <i data-py="0">c</i>
            <i data-py="0.9">o</i>
            <i data-py="0.4">m</i>
            <i data-py="0.3">e</i>
            <i data-py="0.3">&nbsp;</i>
            <i data-py="0.2">P</i>
            <i data-py="0.8">a</i>
            <i data-py="0.6">g</i>
            <i data-py="0.5">e</i>
        </div>
        <div class="hima12">暇つぶし12</div>
        <div>暇つぶし13</div>
        <div>暇つぶし14</div>
        <div>暇つぶし15<div>
        <div>暇つぶし16</div>
        <div>暇つぶし17</div>
        <div>暇つぶし18</div>
        <div>暇つぶし19</div>
        <div>暇つぶし20</div>
    </main>
    <!-- フッター -->
    <footer>
        <ul>
            <li>XXX</li>
            <li>YYY</li>
            <li>ZZZ</li>
            <li>ABC</li>
            <li>DEF</li>
        </ul>
    </footer>
    <!-- エンディング -->
    <div id="ending">
        <div id="ed-content">
            <div id="ed-message">
                GoodBye
            </div>
        </div>
    </div>
    <script>
        /******************* global *******************/
        const winH = window.innerHeight; // 画面の高さ
        const winW = window.innerWidth; // 画面の高さ
        const charTranY = 70; // 文字がずれていくベースの数字(px)
        const animateChar = $("#top").children("i"); // スクロールのアニメーション対象
        let charTop; // onloadで初期化
        let charMinY; // onloadで初期化
        let charMaxY; // onloadで初期化
        let baseScrollPoint; // スクロール基準位置
        let scrollFlg = true; // スクロールの背景色変更用フラグ（連続で同じ処理をしないように）
        
        // 画面表示完了後の値で初期化
        $(window).on('load', function() {
            charTop = $("#top").offset().top;
            charMinY = Math.floor(charTop - winH*.6);
            charMaxY = Math.floor(charTop - winH*.1);
        });

        /******************* ColorObject *******************/
        /* スクロールで背景色を徐々に変更しようと試みるも、cssのtransitionで解決したから不要 */
        // // コンストラクタ
        // const ColorObj = function(r,g,b){
        //     this.red = r,
        //     this.green = g,
        //     this.blue = b
        // };
        // // 色の比較メソッド
        // const hikaku = function(ColorObj1, ColorObj2){
        //     const sabunRed = ColorObj1.red - ColorObj2.red;
        //     const sabunGreen = ColorObj1.green - ColorObj2.green;
        //     const sabunBlue = ColorObj1.blue - ColorObj2.blue;
        //     return new ColorObj(sabunRed, sabunGreen, sabunBlue);
        // };

        // const backColorGoal = new ColorObj("175", "238", "238");
        // let backColorStart = new ColorObj("255", "228", "225");
        // let sabun = hikaku(backColorGoal,backColorStart);
        // let sabun1 = hikaku(backColorGoal,backColorStart);
        // console.log("sabun:" + sabun.red);
        /******************* ColorObject *******************/

        /******************* scroll event *******************/
        $(window).scroll(function() {
            const currentY = Math.floor(window.scrollY); // スクロール位置
            
            // スクロールとともに文字がずれる疑似アニメーション
            if(charMinY < currentY && currentY < charMaxY){
                animateChar.each(function(i,e){
                    var maxTranY = charTranY*$(e).attr("data-py");
                    var per = ((currentY-charMinY)/(charMaxY-charMinY));
                    $(e).css("transform", "translateY(" + Math.floor(maxTranY*per)*(-1) + "px)");
                    $(e).css("opacity", 1-per);
                })
            }
            // 一定の位置で背景色を変化
            if(baseScrollPoint < currentY){
                // 基準位置の方が低い→スクロールダウン時
                if(charTop < currentY && scrollFlg){
                    // charTopの位置を超えていたら
                    $("body").removeClass("changeBgColorScrollUp");
                    $("body").addClass("changeBgColorScrollDown");
                    scrollFlg = false;
                }
            }else{
                // 基準位置の方が高い→スクロールアップ時
                if(charTop > currentY && !scrollFlg){
                    // charTopの位置を超えていなかったら
                    $("body").removeClass("changeBgColorScrollDown");
                    $("body").addClass("changeBgColorScrollUp");
                    scrollFlg = true;
                }

            }
            // スクロール基準位置を変更
            baseScrollPoint = currentY;
        });
    </script>
    <style>
        main div{
            margin: 10% 0;
            text-align: center;
        }
    </style>
</body>
</html>